<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" type="image/png" sizes="96x96" href="/assets/favicon/favicon-96x96.png" />
    <link rel="icon" type="image/svg+xml" href="/assets/favicon/favicon.svg" />
    <link rel="shortcut icon" href="/assets/favicon/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/favicon/apple-touch-icon.png" />
    <link rel="manifest" href="/assets/favicon/site.webmanifest" />
    <title>Adicionales | Prototipo Viva</title>
    <link rel="stylesheet" href="../assets/css/global.css" />
    <link rel="stylesheet" href="./style.css" />
  </head>
  <body>
<div class="adicionales">
      <!-- Header superior -->
      <header class="top-header">
        <div class="container top-header-row">
          <nav class="top-links" aria-label="Navegación superior principal">
            <button type="button" class="ghost-link">Reservar</button>
            <button type="button" class="ghost-link">Información</button>
            <button type="button" class="ghost-link">Doters</button>
            <a href="../booking/" class="ghost-link is-link">Mi Reserva</a>
          </nav>
          <nav class="top-links right" aria-label="Utilidades superiores">
            <button type="button" class="ghost-link">Estatus de vuelo</button>
            <button type="button" class="ghost-link">Promociones</button>
            <button type="button" class="icon-btn" aria-label="Buscar"></button>
            <button type="button" class="ghost-link">MXN</button>
            <a href="../iniciar-sesion/" class="session-btn">Iniciar sesión</a>
          </nav>
        </div>
      </header>
      
      <!-- Header principal -->
      <header class="main-header">
        <div class="container main-header-row">
          <div class="brand-block">
            <button type="button" class="profile-btn" aria-label="Perfil"></button>
            <div>
              <a href="../" class="logo">VIVA AEROBUS</a>
              <p class="logo-sub">Servicios adicionales</p>
            </div>
          </div>
          <div class="main-actions">
            <a href="../crear-cuenta/" class="secondary-btn">Crear cuenta</a>
            <a href="../cart/" class="secondary-btn">Carrito</a>
            <a href="../booking/" class="primary-btn">Mi reserva</a>
          </div>
        </div>
      </header>
      
      <!-- Barra de progreso -->
      <div class="viva-progress-bar" data-current-step="4">
        <div class="viva-progress-container">
          <div class="viva-progress-steps">
            <div class="viva-step">
              <div class="viva-step-number">1</div>
              <span class="viva-step-label">Vuelos</span>
            </div>
            <div class="viva-step-line"></div>
            <div class="viva-step">
              <div class="viva-step-number">2</div>
              <span class="viva-step-label">Combos</span>
            </div>
            <div class="viva-step-line"></div>
            <div class="viva-step">
              <div class="viva-step-number">3</div>
              <span class="viva-step-label">Pasajeros</span>
            </div>
            <div class="viva-step-line"></div>
            <div class="viva-step">
              <div class="viva-step-number">4</div>
              <span class="viva-step-label">Adicionales</span>
            </div>
            <div class="viva-step-line"></div>
            <div class="viva-step">
              <div class="viva-step-number">5</div>
              <span class="viva-step-label">Asientos</span>
            </div>
            <div class="viva-step-line"></div>
            <div class="viva-step">
              <div class="viva-step-number">6</div>
              <span class="viva-step-label">Pagos</span>
            </div>
          </div>
        </div>
      </div>
      
      <div class="servicios"><div class="text-wrapper-6">Servicios adicionales</div></div>
      <div class="rectangle-2"></div>
      <div class="seccion-equipaje">
      <div class="rectangle-3"></div>
      <div class="seleccin">
        <div class="text-wrapper-8">Selección de equipaje</div>
        <div class="text-wrapper-9">A bordo</div>
        <p class="text-wrapper-10">Zero incluye un artículo personal</p>
        <div class="rectangle-5"></div>
        <p class="text-wrapper-11">* Aplica únicamente para el titular de la tarjeta</p>
        <div class="text-wrapper-12">Your name</div>
      </div>
      <div class="opciones">
        <div class="rectangle-6 option-equipaje" data-option="zero">
          <div class="option-label">Sin equipaje adicional</div>
          <div class="option-status">No seleccionado</div>
        </div>
        <div class="rectangle-6 option-equipaje" data-option="uno">
          <div class="option-label">1 maleta adicional</div>
          <div class="option-status">No seleccionado</div>
        </div>
      </div>
      <div class="text-wrapper-13">Artículo personal incluido</div>
      <div class="agregar-maleta">
        <div class="rectangle-7"></div>
        <div class="text-wrapper-14">Agregar maleta</div>
        <div class="text-wrapper-15">Seleccionar</div>
      </div>
      <div class="ellipse"></div>
      <div class="ida-y-regreso">
        <p class="text-wrapper-16">Aplicar para vuelo de ida y regreso</p>
        <div class="rectangle-8"></div>
      </div>
      </div>
      <div class="seccion-documentado">
      <div class="rectangle-4"></div>
      <div class="seleccin-de-equipaje">
        <div class="text-wrapper-17">Selección de equipaje</div>
        <div class="text-wrapper-18">Domentado</div>
        <p class="text-wrapper-19">Zero no incluye equipaje documentado</p>
        <div class="rectangle-9"></div>
        <p class="text-wrapper-11">* Aplica únicamente para el titular de la tarjeta</p>
      </div>
      <div class="opciones-2">
        <div class="rectangle-10 option-documentado" data-option="zero-doc">
          <div class="option-label">Sin equipaje documentado</div>
          <div class="option-status">No seleccionado</div>
        </div>
        <div class="rectangle-10 option-documentado" data-option="uno-doc">
          <div class="option-label">1 maleta documentada</div>
          <div class="option-status">No seleccionado</div>
        </div>
      </div>
      </div>
      <div class="div-wrapper"><p class="p">Personaliza tu viaje a Cancún</p></div>
      <div class="servicios-principales-grid">
      <div class="uber">
        <div class="rectangle-11"></div>
        <div class="rectangle-12"></div>
        <img class="line" src="../assets/img/line-2.svg" />
        <div class="text-wrapper-20">Uber</div>
        <p class="text-wrapper-21">Viaja desde y/o hacia el aeropuerto con Uber de manera rápida y cómoda.</p>
        <div class="rectangle-13"></div>
        <div class="desde-MXN">desde<br /><br /><br />MXN</div>
        <div class="text-wrapper-22">$220</div>
      </div>
      <div class="coco-bongo">
        <div class="rectangle-11"></div>
        <div class="rectangle-14"></div>
        <img class="line" src="../assets/img/line-3.svg" />
        <p class="text-wrapper-23">
          Disfruta de música en vivo, increíbles espectácxulos y la mejor fiesta en Coco Bongo
        </p>
        <div class="text-wrapper-24">Coco Bongo</div>
        <div class="rectangle-15"></div>
        <div class="desde-MXN-2">desde<br /><br /><br />MXN</div>
        <div class="text-wrapper-25">$890</div>
      </div>
      <div class="viva-express">
        <div class="rectangle-16"></div>
        <div class="rectangle-17"></div>
        <div class="text-wrapper-26">Viva Express</div>
        <p class="text-wrapper-27">Pasa directo a nuestra fila express para documentar tu maleta.</p>
        <div class="rectangle-18"></div>
        <div class="desde-MXN-3">desde<br /><br /><br />MXN</div>
        <div class="text-wrapper-28">$150</div>
      </div>
      </div>
      <div class="servicios-2"><div class="text-wrapper-7">Otros servicios</div></div>
      <div class="otros-servicios-grid">
      <div class="viva-transfer">
        <div class="rectangle-19"></div>
        <div class="text-wrapper-29">Viva Transfer</div>
        <div class="desde-MXN-4">desde<br /><br /><br />MXN</div>
        <div class="text-wrapper-30">$189</div>
        <p class="text-wrapper-31">
          Asegura tu transporte desde el aeropuerto hasta destino con nuestro servicio de traslado compartido,
        </p>
        <div class="rectangle-20"></div>
      </div>
      <div class="viva-bus">
        <div class="rectangle-19"></div>
        <div class="text-wrapper-35">Viva Bus</div>
        <div class="desde-MXN-6">desde<br /><br /><br />MXN</div>
        <div class="text-wrapper-36">$179</div>
        <p class="text-wrapper-37">Te transportaremos del aeropuerto a diferentes puntos de la ciudad y de regreso</p>
        <div class="rectangle-22"></div>
      </div>
      <div class="mascota-carga">
        <div class="rectangle-19"></div>
        <div class="desde-MXN-5">desde<br /><br /><br />MXN</div>
        <div class="text-wrapper-32">$699</div>
        <div class="text-wrapper-33">Mascota en carga</div>
        <p class="text-wrapper-34">
          Si tu perro pesa más de 12 kg, podemos transportarlo en una zona de carga especialmente habilitada para
          mascotas.
        </p>
        <div class="rectangle-21"></div>
      </div>
      <div class="mascota-en-cabina">
        <div class="rectangle-19"></div>
        <div class="desde-MXN-6">desde<br /><br /><br />MXN</div>
        <div class="text-wrapper-36">$549</div>
        <div class="text-wrapper-38">Mascota en cabina</div>
        <p class="text-wrapper-39">
          Disfruta de la compañía de tu mascota llevándola contigo debajo del asiento que tengas enfrente
        </p>
        <div class="rectangle-23"></div>
      </div>
      </div>
      <div class="relleno">
        <div class="privacidad">
          <div class="rectangle-24"></div>
          <p class="acepto-el-iso-de-mis">
            <span class="span"
              >Acepto el iso de mis datos personales y la recopilación de datos de todos los pasajeros para una
              operacional, de acuerdo con la
            </span>
            <span class="text-wrapper-40">Política de Privacidad</span>
          </p>
          <div class="addons-total-box" id="addonsTotalBox">
            <span class="addons-total-label">Total adicionales seleccionados</span>
            <strong class="addons-total-value" id="addonsTotalValue">$0 MXN</strong>
          </div>
          <div class="botones-footer">
            <div class="regreso">
              <div class="ellipse-2"></div>
              <img class="flecha-pequena" src="../assets/img/flecha-pequena-izquierda-3-1.png" alt="Regresar" />
            </div>
            <div class="continuar">
              <div class="text-wrapper-45">Continuar</div>
            </div>
          </div>
        </div>
        </div>
        <div class="relleno-footer-wrapper">
          <div class="relleno-footer">
            <div class="rectangle-25"></div>
            <div class="overlap-group">
              <div class="group">
                <div class="group">
                  <div class="rectangle-26"></div>
                  <div class="rectangle-27"></div>
                </div>
                <div class="group-2">
                  <div class="text-wrapper-41">Descarga nuestra App</div>
                  <p class="text-wrapper-42">Aceptamos las siguientes formas de pago</p>
                  <p class="text-wrapper-43">Aeropuerto Internacional de Monterrey. Terminal C</p>
                  <p class="text-wrapper-44">Carretera Miguel Alemán Km 24, Apodaca, NL, México, C.P. 66600</p>
                </div>
              </div>
              <img class="decotracin" src="../assets/img/decotraci-n.png" alt="Decoración" />
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>
  <script>
    const SERVICE_SELECTORS = '.uber, .coco-bongo, .viva-express, .viva-transfer, .viva-bus, .mascota-carga, .mascota-en-cabina';
    const selectedServices = new Set();
    const serviceConfig = {
      'uber': { id: 'uber', name: 'Uber', price: 220 },
      'coco-bongo': { id: 'coco-bongo', name: 'Coco Bongo', price: 890 },
      'viva-express': { id: 'viva-express', name: 'Viva Express', price: 150 },
      'viva-transfer': { id: 'viva-transfer', name: 'Viva Transfer', price: 189, mapsToIntermodal: 'transfer' },
      'viva-bus': { id: 'viva-bus', name: 'Viva Bus', price: 179, mapsToIntermodal: 'bus' },
      'mascota-carga': { id: 'mascota-carga', name: 'Mascota en carga', price: 699 },
      'mascota-en-cabina': { id: 'mascota-cabina', name: 'Mascota en cabina', price: 549 },
    };

    function currency(value) {
      return `$${Number(value || 0).toLocaleString('es-MX')} MXN`;
    }

    function getServiceKeyFromCard(card) {
      if (!card) return null;
      return Object.keys(serviceConfig).find((key) => card.classList.contains(key)) || null;
    }

    function readOrder() {
      try {
        const raw = sessionStorage.getItem('flightCartOrder');
        return raw ? JSON.parse(raw) : null;
      } catch (error) {
        return null;
      }
    }

    function writeOrder(order) {
      try {
        sessionStorage.setItem('flightCartOrder', JSON.stringify(order));
      } catch (error) {
      }
    }

    function resolveServicePrice(key, order) {
      const config = serviceConfig[key];
      if (!config) return 0;

      if (config.mapsToIntermodal && Array.isArray(order?.selectedAddons)) {
        const intermodalAddon = order.selectedAddons.find(
          (addon) => addon?.type === 'intermodal' && addon?.service === config.mapsToIntermodal
        );
        if (intermodalAddon && Number(intermodalAddon.price) > 0) {
          return Number(intermodalAddon.price);
        }
      }

      return Number(config.price || 0);
    }

    function updateAddonsTotal() {
      const order = readOrder();
      const totalNode = document.getElementById('addonsTotalValue');
      if (!totalNode) return;

      let total = 0;
      selectedServices.forEach((key) => {
        total += resolveServicePrice(key, order);
      });

      totalNode.textContent = currency(total);
    }

    function setServicePriceText(cardSelector, valueSelector, key, order) {
      const node = document.querySelector(`${cardSelector} ${valueSelector}`);
      if (!node) return;
      node.textContent = `$${resolveServicePrice(key, order)}`;
    }

    function renderServiceCardPrices() {
      const order = readOrder();
      setServicePriceText('.uber', '.text-wrapper-22', 'uber', order);
      setServicePriceText('.coco-bongo', '.text-wrapper-25', 'coco-bongo', order);
      setServicePriceText('.viva-express', '.text-wrapper-28', 'viva-express', order);
      setServicePriceText('.viva-transfer', '.text-wrapper-30', 'viva-transfer', order);
      setServicePriceText('.viva-bus', '.text-wrapper-36', 'viva-bus', order);
      setServicePriceText('.mascota-carga', '.text-wrapper-32', 'mascota-carga', order);
      setServicePriceText('.mascota-en-cabina', '.text-wrapper-36', 'mascota-en-cabina', order);
    }

    function syncServiceVisual(card, selected) {
      if (!card) return;
      card.classList.toggle('service-selected', selected);
    }

    function toggleService(card) {
      const key = getServiceKeyFromCard(card);
      if (!key) return;

      const selected = selectedServices.has(key);
      if (selected) {
        selectedServices.delete(key);
      } else {
        selectedServices.add(key);
      }

      syncServiceVisual(card, !selected);
      updateAddonsTotal();
    }

    function preloadIntermodalSelectionFromOrder() {
      const order = readOrder();
      if (!order || !Array.isArray(order.selectedAddons)) {
        updateAddonsTotal();
        return;
      }

      const selectedIntermodalServices = order.selectedAddons
        .filter((addon) => addon?.type === 'intermodal')
        .map((addon) => addon.service);

      Object.entries(serviceConfig).forEach(([key, config]) => {
        if (!config.mapsToIntermodal) return;
        if (!selectedIntermodalServices.includes(config.mapsToIntermodal)) return;

        const card = document.querySelector(`.${key}`);
        if (!card) return;

        selectedServices.add(key);
        syncServiceVisual(card, true);
      });

      updateAddonsTotal();
    }

    function persistSelectedAddonsToOrder() {
      const existingOrder = readOrder() || {
        createdAt: new Date().toISOString(),
        search: {},
        roundTrip: false,
        passengers: 1,
        selectedAddons: [],
        totals: { base: 0, tua: 0, ground: 0, extras: 0, grand: 0 },
      };

      const previousAddons = Array.isArray(existingOrder.selectedAddons) ? existingOrder.selectedAddons : [];
      const preservedIntermodal = previousAddons.filter((addon) => addon?.type === 'intermodal');
      const newAddons = [];

      selectedServices.forEach((key) => {
        const config = serviceConfig[key];
        if (!config) return;
        const price = resolveServicePrice(key, existingOrder);

        if (config.mapsToIntermodal) {
          const intermodal = preservedIntermodal.find((addon) => addon?.service === config.mapsToIntermodal);
          if (intermodal) {
            intermodal.price = price;
            intermodal.name = intermodal.name || config.name;
            newAddons.push(intermodal);
            return;
          }

          newAddons.push({
            id: `intermodal-${config.mapsToIntermodal}`,
            type: 'intermodal',
            service: config.mapsToIntermodal,
            name: config.name,
            price,
            quantity: 1,
          });
          return;
        }

        newAddons.push({
          id: `addon-${config.id}`,
          type: 'adicional',
          service: config.id,
          name: config.name,
          price,
          quantity: 1,
        });
      });

      const intermodalTotal = newAddons
        .filter((addon) => addon.type === 'intermodal')
        .reduce((acc, addon) => acc + Number(addon.price || 0), 0);

      const extrasTotal = newAddons
        .filter((addon) => addon.type !== 'intermodal')
        .reduce((acc, addon) => acc + Number(addon.price || 0), 0);

      existingOrder.selectedAddons = newAddons;
      existingOrder.intermodal = intermodalTotal > 0
        ? {
          service: 'mixed',
          option: 'selected',
          label: newAddons.filter((addon) => addon.type === 'intermodal').map((addon) => addon.name).join(' + '),
          totalPrice: intermodalTotal,
        }
        : { service: 'none', option: 'none', label: 'Sin intermodal', totalPrice: 0 };

      existingOrder.totals = existingOrder.totals || {};
      existingOrder.totals.ground = intermodalTotal;
      existingOrder.totals.extras = extrasTotal;
      existingOrder.totals.grand = Number(existingOrder.totals.base || 0)
        + Number(existingOrder.totals.tua || 0)
        + intermodalTotal
        + extrasTotal;

      writeOrder(existingOrder);
    }

    // Manejo de selección de opciones de equipaje
    document.querySelectorAll('.option-equipaje').forEach(option => {
      option.addEventListener('click', function() {
        document.querySelectorAll('.option-equipaje').forEach(opt => {
          opt.classList.remove('selected');
          opt.querySelector('.option-status').textContent = 'No seleccionado';
        });
        this.classList.add('selected');
        this.querySelector('.option-status').textContent = 'Seleccionado';
      });
    });

    // Manejo de selección de opciones de documentado
    document.querySelectorAll('.option-documentado').forEach(option => {
      option.addEventListener('click', function() {
        document.querySelectorAll('.option-documentado').forEach(opt => {
          opt.classList.remove('selected');
          opt.querySelector('.option-status').textContent = 'No seleccionado';
        });
        this.classList.add('selected');
        this.querySelector('.option-status').textContent = 'Seleccionado';
      });
    });

    // Manejo de selección de servicios adicionales usando event delegation (multi-selección)
    document.addEventListener('click', function(e) {
      const serviceCard = e.target.closest(SERVICE_SELECTORS);
      
      if (serviceCard) {
        // No activar si clickeamos en el badge/button específico
        if (e.target.closest('.rectangle-13, .rectangle-15, .rectangle-18, .rectangle-20, .rectangle-22, .rectangle-21, .rectangle-23')) {
          return;
        }

        toggleService(serviceCard);
      }
    });

    // Botones de servicios (badges) usando event delegation
    document.addEventListener('click', function(e) {
      const btn = e.target.closest('.rectangle-13, .rectangle-15, .rectangle-18, .rectangle-20, .rectangle-22, .rectangle-21, .rectangle-23');
      if (btn) {
        e.stopPropagation();
        const service = btn.closest(SERVICE_SELECTORS);
        if (service) {
          toggleService(service);
        }
      }
    });

    // Botón continuar
    document.querySelector('.continuar').addEventListener('click', function() {
      persistSelectedAddonsToOrder();
      window.location.href = '../asientos/';
    });

    // Botón regreso
    document.querySelector('.regreso').addEventListener('click', function() {
      window.history.back();
    });

    preloadIntermodalSelectionFromOrder();
    renderServiceCardPrices();
  </script>
</html>
