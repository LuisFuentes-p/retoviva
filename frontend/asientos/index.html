<!doctype html>
<html lang="es">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<link rel="icon" type="image/png" sizes="96x96" href="/assets/favicon/favicon-96x96.png" />
		<link rel="icon" type="image/svg+xml" href="/assets/favicon/favicon.svg" />
		<link rel="shortcut icon" href="/assets/favicon/favicon.ico" />
		<link rel="apple-touch-icon" sizes="180x180" href="/assets/favicon/apple-touch-icon.png" />
		<link rel="manifest" href="/assets/favicon/site.webmanifest" />
		<title>Selecci√≥n de asientos | Viva Aerobus</title>
		<link rel="stylesheet" href="../assets/css/global.css" />
		<link rel="stylesheet" href="./style.css" />
	</head>
	<body>
		<!-- Header superior -->
		<header class="top-header">
			<div class="container top-header-row">
				<nav class="top-links" aria-label="Navegaci√≥n superior principal">
					<button type="button" class="ghost-link">Reservar</button>
					<button type="button" class="ghost-link">Informaci√≥n</button>
					<button type="button" class="ghost-link">Doters</button>
					<a href="../booking/" class="ghost-link is-link">Mi Reserva</a>
				</nav>
				<nav class="top-links right" aria-label="Utilidades superiores">
					<button type="button" class="ghost-link">Estatus de vuelo</button>
					<button type="button" class="ghost-link">Promociones</button>
					<button type="button" class="icon-btn" aria-label="Buscar">üîé</button>
					<button type="button" class="ghost-link">MXN</button>
					<a href="../iniciar-sesion/" class="session-btn">Iniciar sesi√≥n</a>
				</nav>
			</div>
		</header>

		<!-- Header principal -->
		<header class="main-header">
			<div class="container main-header-row">
				<div class="brand-block">
					<button type="button" class="profile-btn" aria-label="Perfil">üë§</button>
					<div>
						<a href="../pantalla-principal/" class="logo">VIVA AEROBUS</a>
						<p class="logo-sub">Selecci√≥n de asientos</p>
					</div>
				</div>
				<div class="main-actions">
					<a href="../crear-cuenta/" class="secondary-btn">Crear cuenta</a>
					<a href="../cart/" class="secondary-btn">Carrito</a>
					<a href="../booking/" class="primary-btn">Mi reserva</a>
				</div>
			</div>
		</header>

		<!-- Barra de progreso -->
		<div class="viva-progress-bar" data-current-step="5">
			<div class="viva-progress-container">
				<div class="viva-progress-steps">
					<div class="viva-step">
						<div class="viva-step-number">1</div>
						<span class="viva-step-label">Vuelos</span>
					</div>
					<div class="viva-step-line"></div>
					<div class="viva-step">
						<div class="viva-step-number">2</div>
						<span class="viva-step-label">Combos</span>
					</div>
					<div class="viva-step-line"></div>
					<div class="viva-step">
						<div class="viva-step-number">3</div>
						<span class="viva-step-label">Pasajeros</span>
					</div>
					<div class="viva-step-line"></div>
					<div class="viva-step">
						<div class="viva-step-number">4</div>
						<span class="viva-step-label">Adicionales</span>
					</div>
					<div class="viva-step-line"></div>
					<div class="viva-step">
						<div class="viva-step-number">5</div>
						<span class="viva-step-label">Asientos</span>
					</div>
					<div class="viva-step-line"></div>
					<div class="viva-step">
						<div class="viva-step-number">6</div>
						<span class="viva-step-label">Pagos</span>
					</div>
				</div>
			</div>
		</div>

		<!-- Contenido principal -->
		<main class="container main-content">
			<div class="seats-layout">
				<!-- Columna izquierda: Mapa de asientos -->
				<div class="seats-map-section">
					<div class="section-header">
						<div>
							<h1 class="page-title">Selecciona tus asientos</h1>
							<p class="page-subtitle">Vuelo de ida: MTY ‚Üí CUN ‚Ä¢ 24 Feb 2026</p>
						</div>
						<button type="button" class="btn-switch-flight" id="switchFlight">
							Cambiar a vuelo de regreso ‚Üí
						</button>
					</div>

					<!-- Leyenda -->
					<div class="legend">
						<div class="legend-item">
							<div class="seat-icon available"></div>
							<span>Disponible</span>
						</div>
						<div class="legend-item">
							<div class="seat-icon selected"></div>
							<span>Seleccionado</span>
						</div>
						<div class="legend-item">
							<div class="seat-icon occupied"></div>
							<span>Ocupado</span>
						</div>
						<div class="legend-item">
							<div class="seat-icon premium"></div>
							<span>Premium ($200)</span>
						</div>
						<div class="legend-item">
							<div class="seat-icon emergency"></div>
							<span>Salida emergencia ($150)</span>
						</div>
					</div>

					<!-- Mapa del avi√≥n -->
					<div class="airplane-container">
						<div class="airplane-header">
							<div class="cockpit">‚úàÔ∏è Cabina</div>
						</div>

						<div class="seats-grid">
							<!-- Fila 1-5: Asientos Premium -->
							<div class="seat-row-group premium-zone">
								<div class="zone-label">Zona Premium</div>
								
								<!-- Fila 1 -->
								<div class="seat-row">
									<span class="row-number">1</span>
									<button class="seat premium" data-seat="1A" data-price="200">A</button>
									<button class="seat premium" data-seat="1B" data-price="200">B</button>
									<button class="seat premium" data-seat="1C" data-price="200">C</button>
									<div class="aisle"></div>
									<button class="seat premium" data-seat="1D" data-price="200">D</button>
									<button class="seat premium" data-seat="1E" data-price="200">E</button>
									<button class="seat premium" data-seat="1F" data-price="200">F</button>
								</div>

								<!-- Fila 2 -->
								<div class="seat-row">
									<span class="row-number">2</span>
									<button class="seat premium" data-seat="2A" data-price="200">A</button>
									<button class="seat premium occupied" data-seat="2B" data-price="200" disabled>B</button>
									<button class="seat premium" data-seat="2C" data-price="200">C</button>
									<div class="aisle"></div>
									<button class="seat premium" data-seat="2D" data-price="200">D</button>
									<button class="seat premium occupied" data-seat="2E" data-price="200" disabled>E</button>
									<button class="seat premium" data-seat="2F" data-price="200">F</button>
								</div>

								<!-- Fila 3 -->
								<div class="seat-row">
									<span class="row-number">3</span>
									<button class="seat premium" data-seat="3A" data-price="200">A</button>
									<button class="seat premium" data-seat="3B" data-price="200">B</button>
									<button class="seat premium" data-seat="3C" data-price="200">C</button>
									<div class="aisle"></div>
									<button class="seat premium occupied" data-seat="3D" data-price="200" disabled>D</button>
									<button class="seat premium" data-seat="3E" data-price="200">E</button>
									<button class="seat premium" data-seat="3F" data-price="200">F</button>
								</div>
							</div>

							<!-- Fila 10: Salida de emergencia -->
							<div class="seat-row-group emergency-zone">
								<div class="zone-label">Salida de emergencia</div>
								
								<div class="seat-row">
									<span class="row-number">10</span>
									<button class="seat emergency" data-seat="10A" data-price="150">A</button>
									<button class="seat emergency" data-seat="10B" data-price="150">B</button>
									<button class="seat emergency occupied" data-seat="10C" data-price="150" disabled>C</button>
									<div class="aisle"></div>
									<button class="seat emergency" data-seat="10D" data-price="150">D</button>
									<button class="seat emergency" data-seat="10E" data-price="150">E</button>
									<button class="seat emergency" data-seat="10F" data-price="150">F</button>
								</div>
							</div>

							<!-- Filas regulares 11-20 -->
							<div class="seat-row-group regular-zone">
								<div class="zone-label">Zona est√°ndar</div>

								<div class="seat-row">
									<span class="row-number">11</span>
									<button class="seat available" data-seat="11A" data-price="0">A</button>
									<button class="seat available occupied" data-seat="11B" data-price="0" disabled>B</button>
									<button class="seat available" data-seat="11C" data-price="0">C</button>
									<div class="aisle"></div>
									<button class="seat available" data-seat="11D" data-price="0">D</button>
									<button class="seat available" data-seat="11E" data-price="0">E</button>
									<button class="seat available occupied" data-seat="11F" data-price="0" disabled>F</button>
								</div>

								<div class="seat-row">
									<span class="row-number">12</span>
									<button class="seat available" data-seat="12A" data-price="0">A</button>
									<button class="seat available" data-seat="12B" data-price="0">B</button>
									<button class="seat available" data-seat="12C" data-price="0">C</button>
									<div class="aisle"></div>
									<button class="seat available occupied" data-seat="12D" data-price="0" disabled>D</button>
									<button class="seat available" data-seat="12E" data-price="0">E</button>
									<button class="seat available" data-seat="12F" data-price="0">F</button>
								</div>

								<div class="seat-row">
									<span class="row-number">13</span>
									<button class="seat available" data-seat="13A" data-price="0">A</button>
									<button class="seat available occupied" data-seat="13B" data-price="0" disabled>B</button>
									<button class="seat available occupied" data-seat="13C" data-price="0" disabled>C</button>
									<div class="aisle"></div>
									<button class="seat available" data-seat="13D" data-price="0">D</button>
									<button class="seat available" data-seat="13E" data-price="0">E</button>
									<button class="seat available" data-seat="13F" data-price="0">F</button>
								</div>

								<div class="seat-row">
									<span class="row-number">14</span>
									<button class="seat available" data-seat="14A" data-price="0">A</button>
									<button class="seat available" data-seat="14B" data-price="0">B</button>
									<button class="seat available" data-seat="14C" data-price="0">C</button>
									<div class="aisle"></div>
									<button class="seat available" data-seat="14D" data-price="0">D</button>
									<button class="seat available occupied" data-seat="14E" data-price="0" disabled>E</button>
									<button class="seat available" data-seat="14F" data-price="0">F</button>
								</div>

								<div class="seat-row">
									<span class="row-number">15</span>
									<button class="seat available" data-seat="15A" data-price="0">A</button>
									<button class="seat available" data-seat="15B" data-price="0">B</button>
									<button class="seat available occupied" data-seat="15C" data-price="0" disabled>C</button>
									<div class="aisle"></div>
									<button class="seat available" data-seat="15D" data-price="0">D</button>
									<button class="seat available" data-seat="15E" data-price="0">E</button>
									<button class="seat available" data-seat="15F" data-price="0">F</button>
								</div>

								<div class="seat-row">
									<span class="row-number">16</span>
									<button class="seat available occupied" data-seat="16A" data-price="0" disabled>A</button>
									<button class="seat available" data-seat="16B" data-price="0">B</button>
									<button class="seat available" data-seat="16C" data-price="0">C</button>
									<div class="aisle"></div>
									<button class="seat available" data-seat="16D" data-price="0">D</button>
									<button class="seat available" data-seat="16E" data-price="0">E</button>
									<button class="seat available" data-seat="16F" data-price="0">F</button>
								</div>

								<div class="seat-row">
									<span class="row-number">17</span>
									<button class="seat available" data-seat="17A" data-price="0">A</button>
									<button class="seat available" data-seat="17B" data-price="0">B</button>
									<button class="seat available" data-seat="17C" data-price="0">C</button>
									<div class="aisle"></div>
									<button class="seat available occupied" data-seat="17D" data-price="0" disabled>D</button>
									<button class="seat available occupied" data-seat="17E" data-price="0" disabled>E</button>
									<button class="seat available" data-seat="17F" data-price="0">F</button>
								</div>

								<div class="seat-row">
									<span class="row-number">18</span>
									<button class="seat available" data-seat="18A" data-price="0">A</button>
									<button class="seat available" data-seat="18B" data-price="0">B</button>
									<button class="seat available" data-seat="18C" data-price="0">C</button>
									<div class="aisle"></div>
									<button class="seat available" data-seat="18D" data-price="0">D</button>
									<button class="seat available" data-seat="18E" data-price="0">E</button>
									<button class="seat available occupied" data-seat="18F" data-price="0" disabled>F</button>
								</div>
							</div>
						</div>
					</div>

					<!-- Informaci√≥n importante -->
					<div class="info-box">
						<h3 class="info-title">üìã Informaci√≥n importante</h3>
						<ul class="info-list">
							<li>Los asientos en fila 1-3 son Premium con espacio adicional para las piernas</li>
							<li>Los asientos en salida de emergencia requieren que cumplas ciertos requisitos de seguridad</li>
							<li>Si no seleccionas asiento, se te asignar√° uno autom√°ticamente sin costo</li>
							<li>Puedes cambiar tu selecci√≥n hasta 3 horas antes del vuelo</li>
						</ul>
					</div>
				</div>

				<!-- Columna derecha: Resumen -->
				<aside class="seats-summary">
					<div class="summary-card">
						<h2 class="summary-title">Tu selecci√≥n</h2>

						<!-- Pasajeros -->
						<div class="passengers-list" id="passengersList">
							<!-- Se llena din√°micamente seg√∫n cantidad de pasajeros -->
						</div>

						<div class="summary-section">
							<div class="summary-row">
								<span>Costo total de asientos</span>
								<span class="total-seats" id="totalSeats">$0.00</span>
							</div>
						</div>

						<div class="skip-section">
							<p class="skip-text">¬øNo quieres elegir asiento ahora?</p>
							<button type="button" class="btn-skip" id="skipSeats">
								Omitir selecci√≥n (se asignar√° autom√°ticamente)
							</button>
						</div>

						<div class="summary-actions">
							<a href="../pago-1-0/" class="btn-continue" id="continueBtn">Continuar al pago</a>
							<a href="../adicionales/" class="btn-back">Volver a adicionales</a>
						</div>

						<div class="security-badges">
							<span class="badge">üí∫ Reserva garantizada</span>
							<span class="badge">üîÑ Cambios permitidos</span>
						</div>
					</div>

					<!-- Tips de viaje -->
					<div class="tips-banner">
						<div class="tip-icon">üí°</div>
						<div class="tip-content">
							<h4>Consejo de viaje</h4>
							<p>Los asientos junto a la ventana son ideales para descansar y disfrutar la vista</p>
						</div>
					</div>
				</aside>
			</div>
		</main>

		<!-- Footer -->
		<footer class="main-footer">
			<div class="container">
				<div class="footer-content">
					<div class="footer-col">
						<h4>Viva Aerobus</h4>
						<ul>
							<li><a href="#">Acerca de</a></li>
							<li><a href="#">Sala de prensa</a></li>
							<li><a href="#">Trabaja con nosotros</a></li>
						</ul>
					</div>
					<div class="footer-col">
						<h4>Ayuda</h4>
						<ul>
							<li><a href="#">Centro de ayuda</a></li>
							<li><a href="#">Pol√≠ticas</a></li>
							<li><a href="#">Contacto</a></li>
						</ul>
					</div>
					<div class="footer-col">
						<h4>Legal</h4>
						<ul>
							<li><a href="#">T√©rminos y condiciones</a></li>
							<li><a href="#">Privacidad</a></li>
							<li><a href="#">Cookies</a></li>
						</ul>
					</div>
				</div>
				<div class="footer-bottom">
					<p>&copy; 2026 Viva Aerobus. Prototipo educativo.</p>
				</div>
			</div>
		</footer>

		<script>
			let currentFlight = 'outbound';
			let roundTrip = false;
			let passengerCount = 1;
			let currentPassengerIndex = 0;
			const seatSelection = {
				outbound: [],
				return: [],
			};
			const seatButtons = Array.from(document.querySelectorAll('.seat'));
			const baseDisabledSeats = new Set(
				seatButtons.filter((button) => button.disabled).map((button) => button.dataset.seat)
			);

			function readOrder() {
				try {
					const raw = sessionStorage.getItem('flightCartOrder');
					return raw ? JSON.parse(raw) : null;
				} catch (error) {
					return null;
				}
			}

			function writeOrder(order) {
				try {
					sessionStorage.setItem('flightCartOrder', JSON.stringify(order));
				} catch (error) {
				}
			}

			function needsIntermodalSeatStep(order) {
				const intermodalService = String(order?.intermodal?.service || '').toLowerCase();
				if (intermodalService === 'transfer' || intermodalService === 'bus') {
					return true;
				}

				const addons = Array.isArray(order?.selectedAddons) ? order.selectedAddons : [];
				return addons.some((addon) => {
					if (String(addon?.type || '').toLowerCase() !== 'intermodal') return false;
					const service = String(addon?.service || '').toLowerCase();
					return service === 'transfer' || service === 'bus';
				});
			}

			function resolveNextStepRoute(order) {
				return needsIntermodalSeatStep(order)
					? '../viva-transfer-1-1/'
					: '../pago-1-0/';
			}

			function ensureSeatArrays() {
				const normalize = (value) => {
					if (Array.isArray(value)) {
						return Array.from({ length: passengerCount }, (_, index) => value[index] || null);
					}

					if (value && typeof value === 'object' && value.seat) {
						const fallback = Array.from({ length: passengerCount }, () => null);
						fallback[0] = value;
						return fallback;
					}

					return Array.from({ length: passengerCount }, () => null);
				};

				seatSelection.outbound = normalize(seatSelection.outbound);
				seatSelection.return = normalize(seatSelection.return);
			}

			function formatDate(isoDate) {
				if (!isoDate) return '';
				const date = new Date(`${isoDate}T12:00:00`);
				if (Number.isNaN(date.getTime())) return '';
				return date.toLocaleDateString('es-MX', {
					day: '2-digit',
					month: 'short',
					year: 'numeric',
				});
			}

			function currentFlightSubtitle(order) {
				if (!order || !order.search) {
					return currentFlight === 'outbound'
						? 'Vuelo de ida: MTY ‚Üí CUN'
						: 'Vuelo de regreso: CUN ‚Üí MTY';
				}

				const origin = order.search.origin || 'Origen';
				const destination = order.search.destination || 'Destino';
				const departDate = formatDate(order.search.departDate);
				const returnDate = formatDate(order.search.returnDate);

				const paxLabel = ` ‚Ä¢ Pasajero ${currentPassengerIndex + 1} de ${passengerCount}`;

				if (currentFlight === 'outbound') {
					return `Vuelo de ida: ${origin} ‚Üí ${destination}${departDate ? ` ‚Ä¢ ${departDate}` : ''}${paxLabel}`;
				}

				return `Vuelo de regreso: ${destination} ‚Üí ${origin}${returnDate ? ` ‚Ä¢ ${returnDate}` : ''}${paxLabel}`;
			}

			function renderFlightHeader() {
				const order = readOrder();
				roundTrip = Boolean(order?.roundTrip);

				const subtitleNode = document.querySelector('.page-subtitle');
				if (subtitleNode) {
					subtitleNode.textContent = currentFlightSubtitle(order);
				}

				const switchBtn = document.getElementById('switchFlight');
				if (!switchBtn) return;

				if (!roundTrip) {
					switchBtn.style.display = 'none';
					return;
				}

				switchBtn.style.display = 'inline-flex';
				switchBtn.textContent = currentFlight === 'outbound'
					? 'Cambiar a vuelo de regreso ‚Üí'
					: '‚Üê Cambiar a vuelo de ida';
			}

			function clearSeatVisualSelection() {
				document.querySelectorAll('.seat.selected').forEach((seat) => {
					seat.classList.remove('selected');
				});
			}

			function applyPassengerSeatLocks() {
				seatButtons.forEach((button) => {
					const seatCode = button.dataset.seat;
					const isBaseDisabled = baseDisabledSeats.has(seatCode);
					button.disabled = isBaseDisabled;
					button.classList.remove('passenger-locked');
				});

				const selectedInCurrentLeg = (seatSelection[currentFlight] || [])
					.map((item, index) => ({ item, index }))
					.filter(({ item, index }) => item?.seat && index !== currentPassengerIndex);

				selectedInCurrentLeg.forEach(({ item }) => {
					const button = document.querySelector(`.seat[data-seat="${item.seat}"]`);
					if (!button) return;
					button.disabled = true;
					button.classList.add('passenger-locked');
				});
			}

			function renderCurrentFlightSeat() {
				clearSeatVisualSelection();
				applyPassengerSeatLocks();
				const currentSeat = seatSelection[currentFlight][currentPassengerIndex];
				if (!currentSeat?.seat) return;

				const node = document.querySelector(`.seat[data-seat="${currentSeat.seat}"]`);
				if (node && !node.disabled) {
					node.classList.add('selected');
				}
			}

			function syncOrderSeatTotals(order) {
				if (!order) return;

				const outboundPrice = seatSelection.outbound.reduce((sum, item) => sum + Number(item?.price || 0), 0);
				const returnPrice = seatSelection.return.reduce((sum, item) => sum + Number(item?.price || 0), 0);
				const seatsTotal = outboundPrice + returnPrice;

				order.seats = {
					passengerCount,
					outbound: seatSelection.outbound,
					return: seatSelection.return,
					total: seatsTotal,
				};

				order.totals = order.totals || {};
				order.totals.seats = seatsTotal;
				order.totals.grand = Number(order.totals.base || 0)
					+ Number(order.totals.tua || 0)
					+ Number(order.totals.ground || 0)
					+ Number(order.totals.extras || 0)
					+ seatsTotal;
			}

			function renderPassengersList() {
				const container = document.getElementById('passengersList');
				if (!container) return;

				container.innerHTML = '';

				for (let index = 0; index < passengerCount; index += 1) {
					const outboundSeat = seatSelection.outbound[index];
					const returnSeat = seatSelection.return[index];
					const seatLabel = roundTrip
						? `Ida: ${outboundSeat?.seat || 'Sin asiento'} ¬∑ Vuelta: ${returnSeat?.seat || 'Sin asiento'}`
						: (outboundSeat?.seat || 'Sin asiento');
					const passengerTotal = Number(outboundSeat?.price || 0) + Number(returnSeat?.price || 0);

					const item = document.createElement('div');
					item.className = `passenger-item ${index === currentPassengerIndex ? 'is-active' : ''}`;
					item.dataset.index = String(index);
					item.innerHTML = `
						<div class="passenger-info">
							<span class="passenger-name">üë§ Adulto ${index + 1}</span>
							<span class="seat-assigned">${seatLabel}</span>
						</div>
						<span class="seat-price">$${passengerTotal.toFixed(2)}</span>
					`;

					item.addEventListener('click', () => {
						currentPassengerIndex = index;
						renderFlightHeader();
						renderPassengersList();
						renderCurrentFlightSeat();
					});

					container.appendChild(item);
				}
			}

			function updateSummary() {
				const totalOutbound = seatSelection.outbound.reduce((sum, item) => sum + Number(item?.price || 0), 0);
				const totalReturn = seatSelection.return.reduce((sum, item) => sum + Number(item?.price || 0), 0);
				const total = totalOutbound + totalReturn;

				renderPassengersList();

				document.getElementById('totalSeats').textContent = `$${total.toFixed(2)}`;

				const order = readOrder() || {};
				syncOrderSeatTotals(order);
				writeOrder(order);
			}

			function hydrateFromOrder() {
				const order = readOrder();
				const continueBtn = document.getElementById('continueBtn');
				if (continueBtn) {
					continueBtn.setAttribute('href', resolveNextStepRoute(order || {}));
				}

				if (!order) {
					passengerCount = 1;
					ensureSeatArrays();
					renderFlightHeader();
					renderPassengersList();
					renderCurrentFlightSeat();
					updateSummary();
					return;
				}

				roundTrip = Boolean(order.roundTrip);
				passengerCount = Math.max(1, Number(order.passengers || order.seats?.passengerCount || 1));
				if (order.seats) {
					seatSelection.outbound = order.seats.outbound || [];
					seatSelection.return = order.seats.return || [];
				}
				ensureSeatArrays();

				renderFlightHeader();
				renderPassengersList();
				renderCurrentFlightSeat();
				updateSummary();
			}

			document.querySelectorAll('.seat:not(.occupied)').forEach((seatNode) => {
				seatNode.addEventListener('click', function() {
					const seatNumber = this.dataset.seat;
					const seatPrice = Number.parseFloat(this.dataset.price || '0');
					const existing = seatSelection[currentFlight][currentPassengerIndex];

					if (existing?.seat === seatNumber) {
						seatSelection[currentFlight][currentPassengerIndex] = null;
						this.classList.remove('selected');
						updateSummary();
						return;
					}

					seatSelection[currentFlight][currentPassengerIndex] = { seat: seatNumber, price: seatPrice };
					renderCurrentFlightSeat();
					updateSummary();
				});
			});

			document.getElementById('switchFlight').addEventListener('click', function() {
				if (!roundTrip) return;
				currentFlight = currentFlight === 'outbound' ? 'return' : 'outbound';
				renderFlightHeader();
				renderCurrentFlightSeat();
			});

			document.getElementById('skipSeats').addEventListener('click', function() {
				if (confirm('Se te asignar√° un asiento autom√°ticamente sin costo adicional. ¬øDeseas continuar?')) {
					seatSelection.outbound = Array.from({ length: passengerCount }, () => null);
					seatSelection.return = Array.from({ length: passengerCount }, () => null);
					updateSummary();
					const order = readOrder() || {};
					window.location.href = resolveNextStepRoute(order);
				}
			});

			document.getElementById('continueBtn').addEventListener('click', function(e) {
				e.preventDefault();
				const hasOutbound = seatSelection.outbound.every((item) => Boolean(item?.seat));
				const hasReturn = !roundTrip || seatSelection.return.every((item) => Boolean(item?.seat));
				const order = readOrder() || {};
				const nextRoute = resolveNextStepRoute(order);
				if (!hasOutbound || !hasReturn) {
					if (confirm('A√∫n hay pasajeros o tramos sin asiento seleccionado. ¬øDeseas continuar con asignaci√≥n autom√°tica?')) {
						window.location.href = nextRoute;
					}
					return;
				}

				syncOrderSeatTotals(order);
				writeOrder(order);
				window.location.href = nextRoute;
			});

			hydrateFromOrder();
		</script>
	</body>
</html>
