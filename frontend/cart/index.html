<!doctype html>
<html lang="es">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<link rel="icon" type="image/png" sizes="96x96" href="/assets/favicon/favicon-96x96.png" />
		<link rel="icon" type="image/svg+xml" href="/assets/favicon/favicon.svg" />
		<link rel="shortcut icon" href="/assets/favicon/favicon.ico" />
		<link rel="apple-touch-icon" sizes="180x180" href="/assets/favicon/apple-touch-icon.png" />
		<link rel="manifest" href="/assets/favicon/site.webmanifest" />
		<title>Carrito de compras | Viva Aerobus</title>
		<link rel="stylesheet" href="../assets/css/global.css" />
		<link rel="stylesheet" href="./style.css" />
	</head>
	<body>
		<!-- Header superior -->
		<header class="top-header">
			<div class="container top-header-row">
				<nav class="top-links" aria-label="Navegaci√≥n superior principal">
					<button type="button" class="ghost-link">Reservar</button>
					<button type="button" class="ghost-link">Informaci√≥n</button>
					<button type="button" class="ghost-link">Doters</button>
					<a href="../booking/" class="ghost-link is-link">Mi Reserva</a>
				</nav>
				<nav class="top-links right" aria-label="Utilidades superiores">
					<button type="button" class="ghost-link">Estatus de vuelo</button>
					<button type="button" class="ghost-link">Promociones</button>
					<button type="button" class="icon-btn" aria-label="Buscar">üîé</button>
					<button type="button" class="ghost-link">MXN</button>
					<a href="../iniciar-sesion/" class="session-btn">Iniciar sesi√≥n</a>
				</nav>
			</div>
		</header>

		<!-- Header principal -->
		<header class="main-header">
			<div class="container main-header-row">
				<div class="brand-block">
					<button type="button" class="profile-btn" aria-label="Perfil">üë§</button>
					<div>
						<a href="../pantalla-principal/" class="logo">VIVA AEROBUS</a>
						<p class="logo-sub">Tu carrito de compras</p>
					</div>
				</div>
				<div class="main-actions">
					<a href="../crear-cuenta/" class="secondary-btn">Crear cuenta</a>
					<a href="../booking/" class="primary-btn">Mi reserva</a>
				</div>
			</div>
		</header>

		<!-- Barra de progreso -->
		<div class="viva-progress-bar" data-current-step="2">
			<div class="viva-progress-container">
				<div class="viva-progress-steps">
					<div class="viva-step">
						<div class="viva-step-number">1</div>
						<span class="viva-step-label">Vuelos</span>
					</div>
					<div class="viva-step-line"></div>
					<div class="viva-step">
						<div class="viva-step-number">2</div>
						<span class="viva-step-label">Combos</span>
					</div>
					<div class="viva-step-line"></div>
					<div class="viva-step">
						<div class="viva-step-number">3</div>
						<span class="viva-step-label">Pasajeros</span>
					</div>
					<div class="viva-step-line"></div>
					<div class="viva-step">
						<div class="viva-step-number">4</div>
						<span class="viva-step-label">Adicionales</span>
					</div>
					<div class="viva-step-line"></div>
					<div class="viva-step">
						<div class="viva-step-number">5</div>
						<span class="viva-step-label">Asientos</span>
					</div>
					<div class="viva-step-line"></div>
					<div class="viva-step">
						<div class="viva-step-number">6</div>
						<span class="viva-step-label">Pagos</span>
					</div>
				</div>
			</div>
		</div>

		<!-- Contenido principal -->
		<main class="container main-content">
			<div class="cart-layout">
				<!-- Columna izquierda: Detalles -->
				<div class="cart-details">
					<h1 class="page-title">Tu carrito de compras</h1>
					<p class="page-subtitle">Revisa los detalles de tu viaje antes de continuar</p>

					<!-- Vuelos seleccionados -->
					<section class="cart-section">
						<h2 class="section-title">
							<span class="icon">‚úàÔ∏è</span>
							Vuelos seleccionados
						</h2>

						<!-- Vuelo de ida -->
						<div class="flight-card">
							<div class="flight-header">
								<span class="flight-type">Vuelo de ida</span>
								<button type="button" class="btn-change">Cambiar vuelo</button>
							</div>
							<div class="flight-details">
								<div class="flight-route">
									<div class="airport">
										<div class="airport-code">MTY</div>
										<div class="airport-name">Monterrey</div>
										<div class="flight-time">08:30</div>
									</div>
									<div class="flight-duration">
										<div class="duration-line"></div>
										<div class="duration-text">2h 15m</div>
										<div class="plane-icon">‚úà</div>
									</div>
									<div class="airport">
										<div class="airport-code">CUN</div>
										<div class="airport-name">Canc√∫n</div>
										<div class="flight-time">10:45</div>
									</div>
								</div>
								<div class="flight-info">
									<span class="info-item">üìÖ Lun 24 Feb 2026</span>
									<span class="info-item">üí∫ 1 Adulto</span>
									<span class="info-item">üéí Equipaje personal incluido</span>
								</div>
							</div>
						</div>

						<!-- Vuelo de regreso -->
						<div class="flight-card">
							<div class="flight-header">
								<span class="flight-type">Vuelo de regreso</span>
								<button type="button" class="btn-change">Cambiar vuelo</button>
							</div>
							<div class="flight-details">
								<div class="flight-route">
									<div class="airport">
										<div class="airport-code">CUN</div>
										<div class="airport-name">Canc√∫n</div>
										<div class="flight-time">18:15</div>
									</div>
									<div class="flight-duration">
										<div class="duration-line"></div>
										<div class="duration-text">2h 20m</div>
										<div class="plane-icon">‚úà</div>
									</div>
									<div class="airport">
										<div class="airport-code">MTY</div>
										<div class="airport-name">Monterrey</div>
										<div class="flight-time">20:35</div>
									</div>
								</div>
								<div class="flight-info">
									<span class="info-item">üìÖ Vie 28 Feb 2026</span>
									<span class="info-item">üí∫ 1 Adulto</span>
									<span class="info-item">üéí Equipaje personal incluido</span>
								</div>
							</div>
						</div>
					</section>

					<!-- Adicionales seleccionados -->
					<section class="cart-section" id="addons-section">
						<h2 class="section-title">
							<span class="icon">üéÅ</span>
							Servicios adicionales
						</h2>
						
						<div class="addons-empty" id="addons-empty">
							<p>No has agregado servicios adicionales a√∫n</p>
							<a href="../adicionales/" class="btn-add-services">Agregar servicios</a>
						</div>

						<div class="addons-list" id="addons-list" style="display: none;">
							<!-- Se llenar√°n din√°micamente desde el API -->
						</div>

						<div class="add-services-link">
							<a href="../adicionales/" class="link-btn">‚ûï Agregar m√°s servicios</a>
						</div>
					</section>

					<!-- Informaci√≥n importante -->
					<section class="cart-section info-box">
						<h3 class="info-title">üìã Informaci√≥n importante</h3>
						<ul class="info-list">
							<li>Los precios est√°n sujetos a disponibilidad</li>
							<li>Verifica los horarios y fechas antes de continuar</li>
							<li>Puedes agregar servicios adicionales en el siguiente paso</li>
							<li>Los impuestos y cargos ya est√°n incluidos en el precio final</li>
						</ul>
					</section>
				</div>

				<!-- Columna derecha: Resumen -->
				<aside class="cart-summary">
					<div class="summary-card">
						<h2 class="summary-title">Resumen de tu compra</h2>

						<div class="summary-section">
							<h3 class="summary-subtitle">Vuelos</h3>
							<div class="summary-row">
								<span>Tarifa base (2 vuelos)</span>
								<span id="base-fare">$2,499.00</span>
							</div>
							<div class="summary-row">
								<span>Impuestos y cargos</span>
								<span id="taxes">$1,250.00</span>
							</div>
						</div>

						<div class="summary-section" id="addons-summary" style="display: none;">
							<h3 class="summary-subtitle">Servicios adicionales</h3>
							<div id="addons-breakdown">
								<!-- Se llenar√° din√°micamente -->
							</div>
						</div>

						<div class="summary-section promo-section">
							<h3 class="summary-subtitle">¬øTienes un c√≥digo de descuento?</h3>
							<div class="promo-input-group">
								<input type="text" class="promo-input" placeholder="C√≥digo" id="promo-code" />
								<button type="button" class="promo-btn" id="apply-promo">Aplicar</button>
							</div>
							<div class="promo-message" id="promo-message"></div>
						</div>

						<div class="summary-total">
							<div class="total-row">
								<span class="total-label">Total a pagar</span>
								<span class="total-amount" id="total-amount">$3,749.00</span>
							</div>
							<p class="total-currency">MXN ‚Ä¢ Pesos mexicanos</p>
						</div>

						<div class="summary-actions">
							<a href="../informacion-del-pasajero/" class="btn-continue">Continuar con la compra</a>
							<a href="../results/" class="btn-back">Volver a resultados</a>
						</div>

						<div class="security-badges">
							<span class="badge">üîí Compra segura</span>
							<span class="badge">üí≥ M√∫ltiples formas de pago</span>
						</div>
					</div>

					<!-- Banner de promoci√≥n -->
					<div class="promo-banner">
						<div class="promo-icon">üíé</div>
						<div class="promo-content">
							<h4>¬øViajero frecuente?</h4>
							<p>√önete a Viva Rewards y acumula puntos en cada vuelo</p>
							<a href="#" class="promo-link">M√°s informaci√≥n ‚Üí</a>
						</div>
					</div>
				</aside>
			</div>
		</main>

		<!-- Footer -->
		<footer class="main-footer">
			<div class="container">
				<div class="footer-content">
					<div class="footer-col">
						<h4>Viva Aerobus</h4>
						<ul>
							<li><a href="#">Acerca de</a></li>
							<li><a href="#">Sala de prensa</a></li>
							<li><a href="#">Trabaja con nosotros</a></li>
						</ul>
					</div>
					<div class="footer-col">
						<h4>Ayuda</h4>
						<ul>
							<li><a href="#">Centro de ayuda</a></li>
							<li><a href="#">Pol√≠ticas</a></li>
							<li><a href="#">Contacto</a></li>
						</ul>
					</div>
					<div class="footer-col">
						<h4>Legal</h4>
						<ul>
							<li><a href="#">T√©rminos y condiciones</a></li>
							<li><a href="#">Privacidad</a></li>
							<li><a href="#">Cookies</a></li>
						</ul>
					</div>
				</div>
				<div class="footer-bottom">
					<p>&copy; 2026 Viva Aerobus. Prototipo educativo.</p>
				</div>
			</div>
		</footer>

		<script>
			// Cargar datos del carrito desde el API
			async function loadCartData() {
				try {
					const response = await fetch('/api/cart');
					if (!response.ok) {
						console.warn('No se pudo cargar el carrito desde el API');
						return;
					}

					const data = await response.json();
					
					// Actualizar precios
					if (data.subtotal) {
						document.getElementById('base-fare').textContent = 
							`$${(data.subtotal - (data.subtotal * 0.33)).toFixed(2)}`;
						document.getElementById('taxes').textContent = 
							`$${(data.subtotal * 0.33).toFixed(2)}`;
					}

					// Mostrar adicionales si existen
					if (data.selectedAddons && data.selectedAddons.length > 0) {
						const addonsList = document.getElementById('addons-list');
						const addonsEmpty = document.getElementById('addons-empty');
						const addonsSummary = document.getElementById('addons-summary');
						const addonsBreakdown = document.getElementById('addons-breakdown');

						addonsEmpty.style.display = 'none';
						addonsList.style.display = 'block';
						addonsSummary.style.display = 'block';

						// Renderizar adicionales en la lista
						addonsList.innerHTML = data.selectedAddons.map(addon => `
							<div class="addon-item">
								<div class="addon-info">
									<span class="addon-name">${addon.name}</span>
									<button type="button" class="btn-remove" onclick="removeAddon(${addon.id})">Eliminar</button>
								</div>
								<span class="addon-price">$${addon.price.toFixed(2)}</span>
							</div>
						`).join('');

						// Renderizar en el resumen
						addonsBreakdown.innerHTML = data.selectedAddons.map(addon => `
							<div class="summary-row">
								<span>${addon.name}</span>
								<span>$${addon.price.toFixed(2)}</span>
							</div>
						`).join('');
					}

					// Actualizar total
					if (data.total) {
						document.getElementById('total-amount').textContent = 
							`$${data.total.toFixed(2)}`;
					}

				} catch (error) {
					console.error('Error al cargar el carrito:', error);
				}
			}

			// Aplicar c√≥digo promocional
			document.getElementById('apply-promo').addEventListener('click', async () => {
				const promoCode = document.getElementById('promo-code').value.trim();
				const promoMessage = document.getElementById('promo-message');

				if (!promoCode) {
					promoMessage.textContent = 'Por favor ingresa un c√≥digo';
					promoMessage.className = 'promo-message error';
					return;
				}

				try {
					const response = await fetch('/api/promo', {
						method: 'POST',
						headers: { 'Content-Type': 'application/json' },
						body: JSON.stringify({ code: promoCode })
					});

					const data = await response.json();

					if (response.ok && data.discount) {
						promoMessage.textContent = `¬°C√≥digo aplicado! Descuento: $${data.discount}`;
						promoMessage.className = 'promo-message success';
						// Recargar datos para actualizar precios
						loadCartData();
					} else {
						promoMessage.textContent = data.message || 'C√≥digo inv√°lido';
						promoMessage.className = 'promo-message error';
					}
				} catch (error) {
					promoMessage.textContent = 'Error al aplicar el c√≥digo';
					promoMessage.className = 'promo-message error';
				}
			});

			// Funci√≥n para remover adicional
			function removeAddon(addonId) {
				if (confirm('¬øDeseas eliminar este servicio adicional?')) {
					// Aqu√≠ ir√≠a la llamada al API para eliminar
					console.log('Eliminando addon:', addonId);
					loadCartData();
				}
			}

			// Cargar datos al inicio
			loadCartData();
		</script>
	</body>
</html>
