<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" type="image/png" sizes="96x96" href="/assets/favicon/favicon-96x96.png" />
    <link rel="icon" type="image/svg+xml" href="/assets/favicon/favicon.svg" />
    <link rel="shortcut icon" href="/assets/favicon/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/favicon/apple-touch-icon.png" />
    <link rel="manifest" href="/assets/favicon/site.webmanifest" />
    <title>Pago confirmado | Prototipo Viva</title>
    <link rel="stylesheet" href="../assets/css/global.css" />
    <link rel="stylesheet" href="./style.css" />
  </head>
  <body>
    <!-- Header superior -->
    <header class="top-header">
      <div class="container top-header-row">
        <nav class="top-links" aria-label="Navegación superior principal">
          <button type="button" class="ghost-link">Reservar</button>
          <button type="button" class="ghost-link">Información</button>
          <button type="button" class="ghost-link">Doters</button>
          <a href="../booking/" class="ghost-link is-link">Mi Reserva</a>
        </nav>
        <nav class="top-links right" aria-label="Utilidades superiores">
          <button type="button" class="ghost-link">Estatus de vuelo</button>
          <button type="button" class="ghost-link">Promociones</button>
          <button type="button" class="icon-btn" aria-label="Buscar"></button>
          <button type="button" class="ghost-link">MXN</button>
          <a href="../iniciar-sesion/" class="session-btn">Iniciar sesión</a>
        </nav>
      </div>
    </header>

    <!-- Header principal -->
    <header class="main-header">
      <div class="container main-header-row">
        <div class="brand-block">
          <button type="button" class="profile-btn" aria-label="Perfil"></button>
          <div>
            <a href="../" class="logo">VIVA AEROBUS</a>
            <p class="logo-sub">Confirmación</p>
          </div>
        </div>
        <div class="main-actions">
          <a href="../crear-cuenta/" class="secondary-btn">Crear cuenta</a>
          <a href="../cart/" class="secondary-btn">Carrito</a>
          <a href="../booking/" class="primary-btn">Mi reserva</a>
        </div>
      </div>
    </header>

<div class="main-container">
<div class="pago-confirmado">
  <div class="rectangle-120"></div>
  <div class="reservaci-n-confirmada">Reservación confirmada</div>
  <div
    class="el-pago-de-tu-reservaci-n-fue-exitoso-gracias-por-volar-con-viva-aerobus"
  >
    El pago de tu reservación fue exitoso. Gracias por volar con Viva Aerobus
  </div>
  <button type="button" class="action-btn imprimir" id="print-reserva">Imprimir</button>
  <button type="button" class="action-btn imprimir2" id="go-home">Ir al inicio</button>
  <div class="rectangle-122"></div>
  <div class="rectangle-121"></div>
  <div class="rectangle-123"></div>
  <div class="reservaci-n-completada">Reservación completada</div>
  <div class="ya-est-s-listo-para-volar">Ya estás listo para volar</div>
  <div
    class="verifica-que-todos-los-datos-en-tu-reservaci-n-sean-correctos-y-comienza-a-disfrutar-de-tu-viaje"
  >
    Verifica que todos los datos en tu reservación sean correctos y comienza a
    disfrutar de tu viaje.
  </div>
  <div class="group-132">
    <div class="itinerario-de-viaje">Itinerario de viaje</div>
    <div class="group-120">
      <div class="m-xico">México</div>
      <div class="mex">MEX</div>
    </div>
    <div class="group-121">
      <div class="canc-n">Cancún</div>
      <div class="cun">CUN</div>
    </div>
  </div>
  <div class="group-131">
    <div class="rectangle-124"></div>
    <div class="s-b-21-feb">
      Sáb.,
      <br />
      21 Feb.
    </div>
    <div class="_7-00">7:00</div>
    <div class="_10-15">10:15</div>
    <div class="am">AM</div>
    <div class="am2">AM</div>
    <div class="cun2">CUN</div>
    <div class="directo">Directo</div>
    <div class="detalles">Detalles</div>
  </div>
  <div class="group-130">
    <div class="rectangle-125"></div>
    <div class="s-b-29-feb">
      Sáb.,
      <br />
      29 Feb.
    </div>
    <div class="_7-35">7:35</div>
    <div class="_6-10">6:10</div>
    <div class="am3">AM</div>
    <div class="am4">AM</div>
    <div class="mex2">MEX</div>
    <div class="directo2">Directo</div>
    <div class="detalles2">Detalles</div>
  </div>
  <div class="zero">Zero</div>
  <div class="_1-art-culo-personal">1 artículo personal</div>
  <div class="equipaje-y-adicionales">Equipaje y adicionales</div>
  <div class="zero2">Zero</div>
  <div class="_1-art-culo-personal2">1 artículo personal</div>
  <button type="button" class="modificar-mi-resrvaci-n" id="editar-reserva">Modificar mi reservación</button>
  <div class="rectangle-126"></div>
  <button type="button" class="check-in-disponible-en-48-d-a-s" id="checkin-action">
    Check - in disponible en 48 día(s)
  </button>
  <div class="pasajeros">Pasajeros</div>
  <div class="_1-pasajero">1 pasajero</div>
  <div class="asientos">Asientos</div>
  <div class="_1-asiento-seleccionado">1 asiento seleccionado</div>
  <div class="group-125">
    <div class="vuelos-de-salida">Vuelos de salida</div>
    <div class="mex-cun">MEX - CUN</div>
  </div>
  <div class="group-123">
    <div class="rectangle-127"></div>
    <div class="your-name">Your name</div>
    <div class="asiento-sin-seleccionar">Asiento sin seleccionar</div>
  </div>
  <div class="group-126">
    <div class="rectangle-1272"></div>
    <div class="your-name2">Your name</div>
    <div class="asiento-sin-seleccionar2">Asiento sin seleccionar</div>
  </div>
  <div class="group-140">
    <div class="autobus">Autobus</div>
    <div class="viva-bus">VivaBus</div>
    <div class="_2-asiento-seleccionado">2 asiento seleccionado</div>
  </div>
  <div class="group-141">
    <div class="group-1252">
      <div class="viva-bus2">Viva Bus</div>
      <div class="autobus-en-pareja">Autobus en pareja</div>
    </div>
    <div class="group-123">
      <div class="rectangle-1273"></div>
      <div class="your-name3">Your name</div>
      <div class="asiento-sin-seleccionar3">Asiento sin seleccionar</div>
    </div>
    <div class="group-126">
      <div class="rectangle-1274"></div>
      <div class="your-name4">Your name</div>
      <div class="asiento-sin-seleccionar4">Asiento sin seleccionar</div>
    </div>
  </div>
  <div class="group-1262">
    <div class="vuelos-de-regreso">Vuelos de regreso</div>
    <div class="cun-mex">CUN - MEX</div>
  </div>
  <div class="group-124">
    <div class="rectangle-128"></div>
    <div class="your-name5">Your name</div>
    <div class="asiento-sin-seleccionar5">Asiento sin seleccionar</div>
  </div>
  <div class="group-127">
    <div class="rectangle-1282"></div>
    <div class="your-name6">Your name</div>
    <div class="asiento-sin-seleccionar6">Asiento sin seleccionar</div>
  </div>
  <div class="informaci-n-de-pago">Información de pago</div>
  <div class="reservaci-n-pagada">Reservación pagada</div>
  <div class="vuelos">Vuelos</div>
  <div class="group-1272">
    <div class="ciudad-de-m-xico-canc-n">Ciudad de México- Cancún</div>
    <div class="_1-x-tarifa-zero">1x Tarifa Zero</div>
    <div class="_1-x-maleta-de-mano">1x Maleta de mano</div>
  </div>
  <div class="group-128">
    <div class="canc-n-ciudad-de-m-xico">Cancún - Ciudad de México</div>
    <div class="_1-x-tarifa-zero2">1x Tarifa Zero</div>
    <div class="_1-x-maleta-de-mano2">1x Maleta de mano</div>
  </div>
  <div class="detalles3">Detalles</div>
  <div class="rectangle-129"></div>
  <div class="total-de-la-reservaci-n">Total de la reservación</div>
  <div class="impuestos-y-otros-cargos-ya-incluidos">
    Impuestos y otros cargos ya incluidos
  </div>
  <div class="aceptamos-los-siguientes-m-todos-de-pago">
    Aceptamos los siguientes métodos de pago
  </div>
  <div class="_4-221-30">$4,221.30</div>
  <div class="mxn">MXN</div>
  <div class="_592-25">$592.25</div>
  <div class="line-20"></div>
  <div class="sabes-qu-incluye-tu-compra">¿Sabes qué incluye tu compra?</div>
  <div
    class="la-tua-es-lo-que-te-cobran-los-aeropuertos-mexicanos-por-el-uso-de-sus-instalaciones-su-pago-es-obligatorio-para-poder-abordar-tu-vuelo"
  >
    La TUA es lo que te cobran los aeropuertos mexicanos por el uso de sus
    instalaciones. Su pago es obligatorio para poder abordar tu vuelo.
  </div>
  <div class="tu-reservaci-n-con-viva-3-702">
    *Tu reservación con Viva
    <br />
    $3,702
  </div>
  <div class="lo-que-cobran-los-aeropuertos-2-456">
    **Lo que cobran los aeropuertos
    <br />
    $2,456
  </div>
  <div class="lo-que-cobran-el-gobierno-593">
    **Lo que cobran el gobierno
    <br />
    $593
  </div>
  <div class="group-143">
    <div
      class="cubre-la-emisi-n-de-tu-boleto-las-mosiones-bancarias-el-uso-de-mostradores-de-documentaci-n-el-transporte-de-tu-equipaje-los-servicios-adicionales-que-hayas-adquirido-el-personal-de-aeropuerto-sobrecargos-pilotos-tu-vuelo-el-mantenimiento-el-uso-de-las-pistas-el-avi-n-etc"
    >
      *Cubre la emisión de tu boleto, las mosiones bancarias, el uso de
      mostradores de documentación, el transporte de tu equipaje, los servicios
      adicionales que hayas adquirido, el personal de aeropuerto sobrecargos
      pilotos, tu vuelo, el mantenimiento, el uso de las pistas, el avión, etc.
    </div>
    <div
      class="tua-y-otros-cargos-aeroportuarios-la-tarifa-de-uso-de-aeropuerto-es-un-cargo-por-el-uso-de-instalaciones-como-ba-os-y-salas-de-espera"
    >
      **TUA y otros cargos aeroportuarios: La tarifa de uso de aeropuerto es un
      cargo por el uso de instalaciones como baños y salas de espera.
    </div>
    <div
      class="iva-tanto-de-tu-boleto-como-de-servicios-adicionales-e-incluso-iva-sobre-la-tua"
    >
      *** IVA: Tanto de tu boleto, como de servicios adicionales e incluso IVA
      sobre la TUA.
    </div>
  </div>
  <button type="button" class="saber-m-s" id="toggle-detalles">Saber más</button>
</div>
    </div>
  </body>

  <script>
    function readOrder() {
      try {
        const raw = sessionStorage.getItem('flightCartOrder');
        return raw ? JSON.parse(raw) : null;
      } catch (error) {
        return null;
      }
    }

    function setText(selector, value) {
      const node = document.querySelector(selector);
      if (node && typeof value === 'string') node.textContent = value;
    }

    function money(value) {
      return `$${Number(value || 0).toLocaleString('es-MX', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
    }

    function shortCode(place) {
      const clean = String(place || '').replace(/\(.*?\)/g, '').replace(/[^A-Za-zÁÉÍÓÚÜÑáéíóúüñ\s]/g, ' ').trim();
      if (!clean) return '---';
      const words = clean.split(/\s+/).filter(Boolean);
      if (words.length >= 2) return `${words[0][0] || ''}${words[1][0] || ''}${words[2]?.[0] || ''}`.toUpperCase();
      return clean.slice(0, 3).toUpperCase();
    }

    function formatTime24(hhmm) {
      if (!hhmm || !hhmm.includes(':')) return '--:--';
      const [h, m] = hhmm.split(':');
      return `${String(h).padStart(2, '0')}:${String(m).padStart(2, '0')}`;
    }

    function formatShortDate(isoDate) {
      if (!isoDate) return '-';
      const d = new Date(`${isoDate}T12:00:00`);
      if (Number.isNaN(d.getTime())) return '-';
      return d.toLocaleDateString('es-MX', { weekday: 'short', day: '2-digit', month: 'short' });
    }

    function countSelectedSeats(order) {
      const outbound = Array.isArray(order?.seats?.outbound) ? order.seats.outbound : [];
      const incoming = Array.isArray(order?.seats?.return) ? order.seats.return : [];
      return outbound.filter((item) => item?.seat).length + incoming.filter((item) => item?.seat).length;
    }

    function toggleReturnSections(showReturn) {
      const selectors = ['.group-130', '.group-1262', '.group-124', '.group-127', '.group-128', '._1-x-tarifa-zero2', '._1-x-maleta-de-mano2'];
      selectors.forEach((selector) => {
        const node = document.querySelector(selector);
        if (!node) return;
        node.style.display = showReturn ? '' : 'none';
      });
    }

    function hydrateConfirmedInfo() {
      const order = readOrder();
      if (!order) return;

      const outbound = order.selectedOutbound;
      const incoming = order.selectedReturn;

      setText('.m-xico', order.search?.origin || 'Origen');
      setText('.canc-n', order.search?.destination || 'Destino');
      setText('.mex', shortCode(order.search?.origin));
      setText('.mex2', shortCode(order.search?.origin));
      setText('.cun', shortCode(order.search?.destination));
      setText('.cun2', shortCode(order.search?.destination));
      setText('.mex-cun', `${shortCode(order.search?.origin)} - ${shortCode(order.search?.destination)}`);
      setText('.cun-mex', `${shortCode(order.search?.destination)} - ${shortCode(order.search?.origin)}`);
      toggleReturnSections(Boolean(order.roundTrip));

      setText('.s-b-21-feb', formatShortDate(order.search?.departDate));
      setText('.s-b-29-feb', order.roundTrip ? formatShortDate(order.search?.returnDate) : 'Sin regreso');
      setText('._7-00', formatTime24(outbound?.departTime));
      setText('._10-15', formatTime24(outbound?.arriveTime));
      setText('._6-10', formatTime24(incoming?.departTime));
      setText('._7-35', formatTime24(incoming?.arriveTime));

      const passengers = Number(order.passengers || 1);
      const selectedSeatCount = countSelectedSeats(order);

      setText('._1-pasajero', `${passengers} ${passengers === 1 ? 'pasajero' : 'pasajeros'}`);
      setText('._1-asiento-seleccionado', `${selectedSeatCount} ${selectedSeatCount === 1 ? 'asiento seleccionado' : 'asientos seleccionados'}`);

      setText('.your-name', 'Adulto 1');
      setText('.your-name2', passengers > 1 ? 'Adulto 2' : '-');
      setText('.your-name3', 'Adulto 1');
      setText('.your-name4', passengers > 1 ? 'Adulto 2' : '-');
      setText('.your-name5', 'Adulto 1');
      setText('.your-name6', passengers > 1 ? 'Adulto 2' : '-');

      const firstOutboundSeat = Array.isArray(order?.seats?.outbound) ? order.seats.outbound[0]?.seat : null;
      const secondOutboundSeat = Array.isArray(order?.seats?.outbound) ? order.seats.outbound[1]?.seat : null;
      const firstReturnSeat = Array.isArray(order?.seats?.return) ? order.seats.return[0]?.seat : null;
      const secondReturnSeat = Array.isArray(order?.seats?.return) ? order.seats.return[1]?.seat : null;

      setText('.asiento-sin-seleccionar', firstOutboundSeat || 'Asiento sin seleccionar');
      setText('.asiento-sin-seleccionar2', secondOutboundSeat || 'Asiento sin seleccionar');
      setText('.asiento-sin-seleccionar3', firstOutboundSeat || 'Asiento sin seleccionar');
      setText('.asiento-sin-seleccionar4', secondOutboundSeat || 'Asiento sin seleccionar');
      setText('.asiento-sin-seleccionar5', firstReturnSeat || 'Asiento sin seleccionar');
      setText('.asiento-sin-seleccionar6', secondReturnSeat || 'Asiento sin seleccionar');

      const finalTotal = Number(order.totals?.final || order.totals?.payable || order.totals?.grand || 0);
      const tua = Number(order.totals?.tua || 0);
      const basePlusServices = Number(order.totals?.base || 0)
        + Number(order.totals?.ground || 0)
        + Number(order.totals?.extras || 0)
        + Number(order.totals?.seats || 0)
        + Number(order.totals?.protection || 0);

      setText('._4-221-30', money(finalTotal));
      setText('._592-25', money(tua));
      setText('.tu-reservaci-n-con-viva-3-702', `*Tu reservación con Viva\n${money(basePlusServices)}`);
      setText('.lo-que-cobran-los-aeropuertos-2-456', `**Lo que cobran los aeropuertos\n${money(tua)}`);
      setText('.lo-que-cobran-el-gobierno-593', `***Lo que cobran el gobierno\n${money(Number(tua * 0.16))}`);

      if (order.paymentMethod?.label) {
        setText('.reservaci-n-pagada', `Reservación pagada · ${order.paymentMethod.label}`);
      }
    }

    const printButton = document.getElementById('print-reserva');
    const homeButton = document.getElementById('go-home');
    const editButton = document.getElementById('editar-reserva');
    const checkinButton = document.getElementById('checkin-action');
    const detailsButton = document.getElementById('toggle-detalles');
    const detailsGroup = document.querySelector('.group-143');

    if (printButton) {
      printButton.addEventListener('click', function () {
        window.print();
      });
    }

    if (homeButton) {
      homeButton.addEventListener('click', function () {
        window.location.href = '../pantalla-principal/';
      });
    }

    if (editButton) {
      editButton.addEventListener('click', function () {
        window.location.href = '../booking/';
      });
    }

    if (checkinButton) {
      checkinButton.addEventListener('click', function () {
        window.location.href = '../iniciar-sesion/';
      });
    }

    if (detailsButton && detailsGroup) {
      detailsButton.textContent = 'Ocultar';
      detailsButton.addEventListener('click', function () {
        detailsGroup.classList.toggle('details-collapsed');
        detailsButton.textContent = detailsGroup.classList.contains('details-collapsed') ? 'Saber más' : 'Ocultar';
      });
    }

    hydrateConfirmedInfo();
  </script>
</html>
